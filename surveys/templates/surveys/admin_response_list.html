{% extends "surveys/base.html" %}

{% block title %}الاجابات على الاستبيان {{ survey.title }}{% endblock %}

{% block content %}
<div class="container">
    <!-- Header: Contains the title and toggle button -->
    <div id="header" class="d-flex justify-content-between align-items-center mb-3">
        <h1>الاجابات على"{{ survey.title }}"</h1>
    </div>

    <!-- HTMX Container: This is refreshed dynamically -->
    <div id="admin-response-list"
         hx-get="{% url 'admin_response_list' survey.id %}?partial=true"
         hx-trigger="every 3s"
         hx-swap="innerHTML">
        {% include "surveys/partials/admin_response_list.html" with responses=responses %}
    </div>
    
    <div class="text-center mt-4">
      <a href="{% url 'survey_list' %}" class="btn btn-secondary">Back to Surveys</a>
      <br>
      <br>
      
      <button id="toggle-autoscroll" class="btn btn-secondary" data-enabled="true">Disable Auto Scroll</button>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        let autoScrollEnabled = true;
        const toggleBtn = document.getElementById("toggle-autoscroll");
        
        function updateButtonText() {
            toggleBtn.textContent = autoScrollEnabled ? "Disable Auto Scroll" : "Enable Auto Scroll";
        }
        
        toggleBtn.addEventListener("click", function () {
            autoScrollEnabled = !autoScrollEnabled;
            updateButtonText(); // Update button text immediately
        });

        document.body.addEventListener("htmx:afterSwap", function () {
            if (autoScrollEnabled) {
                window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
            }
        });

        // Set initial button text
        updateButtonText();
    });
</script>
{% endblock %}
